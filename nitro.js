const axios = require('axios')
const fs = require('fs')

const apiUrl = 'https://api.discord.gx.games/v1/direct-fulfillment'
const partnerUserId = '688413a4774e05ef031756fff85178e75f5a18d96d47d9f8c92f31bd7591dd5f'
const outputFile = 'nitro.txt'

let lines = fs.readFileSync(outputFile, 'utf-8').split(/\r?\n/).length
let delay = 30

const nitro = async () => {
    try {
        const res = await axios.post(apiUrl, { partnerUserId })
        const token = res.data.token
        const final = `https://discord.com/billing/partner-promotions/1180231712274387115/${token}`
        fs.appendFileSync(outputFile, final + '\n')
        lines++
        console.log('Generated Nitro Code ' + lines)
        delay = 30
    } catch (err) {
        console.log(`Error Generating Nitro Code. Retrying in ${delay} seconds...`)
        await sleep(delay * 1000)
        // Increase the delay exponentially, up to a maximum of 4 minutes (240 seconds)
        delay = Math.min(delay * 2, 240)
        await nitro()
    }
};

const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms))

const runNitro = async () => {
    while (true) {
        await nitro();
    }
};

runNitro();
